<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Insurance Payment</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f6fa;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #0d6efd;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: auto;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 10px;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #0d6efd;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      margin-top: 15px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #0b5ed7;
    }
    #errorBox {
      display: none;
      background: #ffe5e5;
      color: #b00020;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
    #receiptCard {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: 20px auto;
      line-height: 1.6;
    }
    #cardActions {
      display: none;
      text-align: center;
      margin-top: 10px;
    }
    .info-label {
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

<h2>üì± ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§á‡§Ç‡§∂‡•ç‡§Ø‡•ã‡§∞‡•á‡§Ç‡§∏ ‡§´‡•â‡§∞‡•ç‡§Æ</h2>

<div id="errorBox"></div>

<form id="dataForm">

  <label>Customer Name</label>
  <input type="text" name="CustomerName" required>

  <label>Gender</label>
  <select name="Gender" required>
    <option value="">Select</option>
    <option>Male</option>
    <option>Female</option>
    <option>Other</option>
  </select>

  <label>Date of Birth</label>
  <input type="date" name="DateOfBirth" required>

  <label>Aadhar Number</label>
  <input type="text" name="Aadhar" maxlength="12" required>

  <label>Mobile</label>
  <input type="tel" name="Mobile" maxlength="10" required>

  <label>Email</label>
  <input type="email" name="Email">

  <label>Address</label>
  <textarea name="Address" rows="2"></textarea>

  <label>Mobile Model</label>
  <input type="text" name="MobileModel">

  <label>IMEI 1</label>
  <input type="text" name="IMEI1">

  <label>IMEI 2</label>
  <input type="text" name="IMEI2">

  <label>Buying Date</label>
  <input type="date" name="BuyingDate">

  <label>Bill Number</label>
  <input type="text" name="BillNumber">

  <label>Warranty Status</label>
  <select name="WarrantyStatus">
    <option>Under Warranty</option>
    <option>Out of Warranty</option>
  </select>

  <label>Valid Upto</label>
  <input type="date" name="ValidUpto">

  <label>Premium Amount (‚Çπ)</label>
  <input type="number" name="Premium" required>

  <label>Dealer Name</label>
  <input type="text" name="DealerName">

  <label>Shop Name</label>
  <input type="text" name="ShopName">

  <label>Dealer Contact</label>
  <input type="tel" name="DealerContact">

  <label>Dealer ID</label>
  <input type="text" name="DealerID">

  <label>Dealer Address</label>
  <textarea name="DealerAddress" rows="2"></textarea>

  <button type="submit">Submit & Pay</button>
</form>

<!-- ‚úÖ Receipt Card -->
<div id="receiptCard">
  <h2>‚úÖ Payment Successful</h2>
  <p><span class="info-label">Insurance ID:</span> <span id="rInsId"></span></p>
  <p><span class="info-label">Customer Name:</span> <span id="rCustomer"></span></p>
  <p><span class="info-label">Mobile:</span> <span id="rMobile"></span></p>
  <p><span class="info-label">Valid Upto:</span> <span id="rValid"></span></p>
  <p><span class="info-label">Payment ID:</span> <span id="rPayment"></span></p>
  <p><span class="info-label">Dealer Name:</span> <span id="rDealer"></span></p>
  <p><span class="info-label">Dealer ID:</span> <span id="rDealerId"></span></p>
  <p><span class="info-label">Dealer Mobile:</span> <span id="rDealerMobile"></span></p>
  <p><span class="info-label">Shop Name:</span> <span id="rShop"></span></p>
</div>

<div id="cardActions">
  <button onclick="window.print()">üñ®Ô∏è Print Receipt</button>
  <button onclick="window.location.reload()">üîÅ New Entry</button>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzRd-vQ3LUMvOKgkSPLYb6VL9KdiN58Q5zCiJVYFeWDHvGw4BG-jalS1yDGTF2sr5DV/exec"; // ‚úÖ Your Script URL
  const RAZORPAY_KEY = "RN0gNK14f1run6y"; // ‚úÖ Replace with your Razorpay Key

  const form = document.getElementById("dataForm");
  const errorBox = document.getElementById("errorBox");
  const receiptCard = document.getElementById("receiptCard");
  const cardActions = document.getElementById("cardActions");

  form.addEventListener("submit", function(e) {
    e.preventDefault();
    errorBox.style.display = "none";

    const fd = new FormData(form);
    const premium = parseFloat(fd.get("Premium"));
    if (isNaN(premium) || premium <= 0) {
      showError("‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä Premium ‡§∞‡§æ‡§∂‡§ø (‚Çπ) ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§");
      return;
    }

    const amountPaise = Math.round(premium * 100);

    const options = {
      key: RAZORPAY_KEY,
      amount: amountPaise,
      currency: "INR",
      name: "Mobile Insurance",
      description: "Insurance Premium Payment",
      handler: function(response) {
        fd.append("PaymentID", response.razorpay_payment_id);
        submitDataToSheet(fd);
      },
      prefill: {
        name: fd.get("CustomerName"),
        email: fd.get("Email"),
        contact: fd.get("Mobile")
      },
      theme: { color: "#0d6efd" }
    };

    const rzp = new Razorpay(options);
    rzp.on("payment.failed", function(resp) {
      showError("‚ö†Ô∏è Payment failed: " + resp.error.description);
    });
    rzp.open();
  });

  function showError(msg) {
    errorBox.innerText = msg;
    errorBox.style.display = "block";
  }

  function submitDataToSheet(fd) {
    const btn = form.querySelector("button[type='submit']");
    btn.disabled = true;
    btn.textContent = "Saving...";

    fetch(scriptURL, { method: "POST", body: fd })
      .then(res => res.json())
      .then(data => {
        btn.disabled = false;
        btn.textContent = "Submit & Pay";
        if (data.result !== "success") {
          showError("‚ùå " + data.message);
          return;
        }

        document.getElementById("rCustomer").textContent = data.customerName;
        document.getElementById("rInsId").textContent = data.insuranceId;
        document.getElementById("rValid").textContent = data.validUpto;
        document.getElementById("rMobile").textContent = data.mobile;
        document.getElementById("rPayment").textContent = data.paymentId;
        document.getElementById("rDealer").textContent = data.dealerName;
        document.getElementById("rDealerId").textContent = data.dealerId;
        document.getElementById("rDealerMobile").textContent = data.dealerMobile;
        document.getElementById("rShop").textContent = data.shopName;

        form.style.display = "none";
        receiptCard.style.display = "block";
        cardActions.style.display = "block";
      })
      .catch(err => {
        btn.disabled = false;
        btn.textContent = "Submit & Pay";
        showError("‚ö†Ô∏è Script Error: " + err.message);
      });
  }
</script>

</body>
</html>
